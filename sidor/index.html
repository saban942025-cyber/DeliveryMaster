<script type="module">
    // --- ייבוא מודולי ליבה ---
    import {
        db, auth, authReadyPromise, functions, SmartLog, showToast,
        collection, doc, onSnapshot, query, orderBy, addDoc, updateDoc,
        serverTimestamp, deleteDoc, arrayUnion, where, getDocs, setDoc, limit, getDoc,
        Timestamp
    } from '../shared/firebase-init.js'; // <-- נתיב יחסי תוקן

    // --- ייבוא מודול מפות ---
    import {
        initMap, geocodeAddress, ISRAEL_CENTER, WAREHOUSE_LOCATIONS,
        driverIconActive, driverIconStuck, orderIconNew,
        updateMarker, removeOldMarkers, fitMapToBounds, calculateRouteDistance
    } from '../shared/map-utils.js'; // <-- נתיב יחסי תוקן

    // --- (Rest of the original functions and initialization logic are assumed present) ---
    // ההגדרות המקומיות של initMap, geocodeAddress, ISRAEL_CENTER והאייקונים הוסרו.

    async function initializeApplication() {
        // ...
        try {
            // שימוש ב-initMap המיובא
            map = initMap('map'); 
            if (!map) { throw new Error("Map initialization failed."); }
            // ...
            await authReadyPromise;
            // ... (Rest of listeners and logic) ...
        } catch (error) { /* ... */ }
    }
    
    // ... (renderMapMarkers now uses updateMarker, removeOldMarkers, fitMapToBounds, and imported icons) ...
    
    async function submitNewOrder(event) {
        // ... (Logic remains the same, but now calls imported geocodeAddress) ...
        const coords = await geocodeAddress(customerAddress); // <-- שימוש בפונקציה המיובאת
        // ...
    }
    // ... (Rest of the original functions are assumed present and adjusted) ...
</script>
